# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a local Docker-based development stack for **gitea-mcp-local** that provides:
- **Gitea** git repository server (web UI on :3000, SSH on :2222)
- **PostgreSQL** database backend
- **Gitea MCP Server** for MCP client integration (SSE endpoint on :8081)

The stack enables MCP clients (Cursor, Claude Desktop, etc.) to interact with a local Gitea instance via Server-Sent Events.

## Essential Commands

### Stack Management
```bash
# Start the complete stack (db + gitea + mcp)
make up

# Stop all services
make down

# Complete reset (removes all data and volumes)
make reset

# View logs
make logs

# Check service status
make ps

# Shell into container (default: gitea)
make sh
# Or specify service: S=mcp make sh
```

### Manual Operations
```bash
# Initialize admin user and MCP token (called by make up)
./scripts/init.sh

# View current MCP token
./scripts/print_token.sh

# Complete stack reset
./scripts/reset.sh
```

## Configuration

### Environment Setup
1. Copy `.env.example` to `.env`
2. Modify values if needed (ports, credentials, etc.)
3. `GITEA_TOKEN` is auto-generated by `init.sh`

### Key Environment Variables
- `HTTP_PORT=3000` - Gitea web interface
- `SSH_PORT=2222` - Gitea SSH access
- `MCP_PORT=8081` - MCP Server SSE endpoint
- `GITEA_ADMIN_USER/PASS` - Admin credentials
- `POSTGRES_*` - Database connection settings

## Architecture

### Services Architecture
1. **PostgreSQL** (`db`) - Data persistence layer
2. **Gitea** (`gitea`) - Git server with web interface
   - Waits for database health check
   - Creates admin user via API during initialization
3. **MCP Server** (`mcp`) - Bridge between MCP clients and Gitea
   - Waits for Gitea to be healthy
   - Provides SSE endpoint for MCP protocol

### Data Flow
- MCP clients → MCP Server (SSE) → Gitea (REST API) → PostgreSQL
- Web users → Gitea Web UI → PostgreSQL

### Key Integration Points
- `settings.json` - MCP client configuration pointing to SSE endpoint
- `init.sh` - Automated setup creating admin user and API token
- Docker health checks ensure proper startup sequence

## Development Workflow

The system is designed for experimentation with MCP integrations:
1. Start stack with `make up`
2. Access Gitea at http://localhost:3000 (admin/admin1234)
3. Configure MCP clients to use http://localhost:8081/sse
4. Use `settings.json` for Claude Desktop MCP configuration